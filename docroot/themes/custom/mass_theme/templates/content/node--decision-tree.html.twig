{#
/**
 * @file
 * Theme override to display the full view mode of the Decision Tree content type.
 */
#}
{% extends 'node.html.twig' %}

{# Set top heading level for the page. #}
{% set level = 1 %}

{% block preContent %}

  {# Check if primary indicator content exists. #}
  {% set primaryIndicators = null %}
  {% set primaryRelationshipContent = null %}
  {#
  {% if content.computed_related_to[0] %}
    {% set primaryIndicators = { "label": "part of" } %}
    {% set primaryRelationshipContent = content.computed_related_to %}
  {% endif %}
  #}
  {% set secondaryIndicators = false %}
  {% if content.field_organizations is not empty %}
    {% set secondaryIndicators = {
      "icon": "building",
      "label": "offered by",
      "groupAfter": 3
    } %}
  {% endif %}

  {% embed "@molecules/relationship-indicators.twig" with {
    "relationshipIndicators": {
      "pageTitle": node.label,
      "primary": primaryIndicators,
      "secondary": secondaryIndicators
    }
  } %}
    {% block primaryRelationship %}
      {{ primaryRelationshipContent }}
    {% endblock %}
    {% block secondaryRelationship %}
      {{ content.field_organizations }}
    {% endblock %}
  {% endembed %}

  {% include "@organisms/page-header/page-header.twig" with {
    "pageHeader": {
      "divider": false,
      "title": label,
      "widgets": null
    },
  } %}
{% endblock %}

{% block main %}
  <div class="main-content main-content--two"></div>

  <script id="root-content" type="text/x-handlebars-template">
    {% verbatim %}
      <div class="page-content ma__decision-tree-node ma__decision-tree-node--start">
        <h2 class="ma__colored-heading ma__colored-heading--blue">
          {{#if root.editLink }}<a href="{{root.editLink}}" class="edit-link">[edit]</a>{{/if}}
          Get Started
        </h2>
        {{#if root.text}}<h3 class="ma__decision-tree__qa">{{root.text}}</h3>{{/if}}
        {{#if root.details}}
        <p>{{{root.details}}}</p>
        {{/if}}

        {{#if root.startText }}
        <section class="ma__key-actions">
          <div class="ma__key-actions__container">
            <div class="ma__key-actions__items">
              <div class="ma__callout-link">
                <a href="#" class="start"><span class="ma__callout-link__container"><span class="ma__callout-link__text" >{{root.startText}}&nbsp;
                {{ icon('arrow')}}
                </span></span></a>
              </div>
            </div>
          </div>
        </section>
        {{/if}}
      </div>
    {% endverbatim %}
  </script>

  <script id="branch-content" type="text/x-handlebars-template">
    {% verbatim %}
      <div class="page-content ma__decision-tree-node ma__decision-tree-node--question">
        <h2 class="ma__colored-heading ma__colored-heading--blue">
          {{#if step.editLink }}<a href="{{step.editLink}}" class="edit-link">[edit]</a>{{/if}}
          Question
        </h2>
        <h3 class="ma__decision-tree__qa" id="question">{{step.text}}</h3>
        {{#if step.details}}
        <p>{{{step.details}}}</p>
        {{/if}}

        {{#if step.moreInfo}}
        <section class="ma__action-step js-accordion ma__action-step--accordion question-more-info">
          <button class="ma__action-step__header js-accordion-link" aria-label="Expand {{step.moreInfo.title}}">
            <h2 class="ma__action-step__title">{{step.moreInfo.title}}</h2>
          </button>
          <div class="ma__action-step__content js-accordion-content">
            <section class="ma__rich-text js-ma-rich-text">
              <p>{{{step.moreInfo.details}}}</p>
            </section>
          </div>
        </section>
        {{/if}}

        {{#if step.responses}}
        <div class="ma__decision-tree-node__responses">
          {{#each step.responses}}
            <button type="button" class="ma__button ma__button--uppercase ma__button--minor" aria-label="{{text}}" data-response="{{id}}" aria-describedby="question">{{text}}</button>
          {{/each}}
        </div>
        {{/if}}
        {{#if step.disclaimer}}
        <p class="disclaimer"><em>{{step.disclaimer}}</em></p>
        {{/if}}
        <div class="back">
          <a href="#">
            {{ icon('caret-left', '36px', '36px') }}
            Go Back
          </a>
        </div>
        <div class="restart">
          <a href="#">Start Over</a>
        </div>
      </div>
      <aside class="sidebar">
        <div class="ma__decision-tree-responses">
          <h2 class="ma__colored-heading ">Your Responses</h2>
          <section class="ma__link-list">
            <div class="ma__link-list__container">
              <ul class="ma__link-list__items ">
                {{#each responses}}
                <li class="ma__link-list__item">
                  <span class="ma__input-checkbox">
                    <input type="checkbox" value="checkbox" id="checkbox-test" checked disabled>
                    <label for="checkbox-test"><span>{{explainer}}</span></label>
                  </span>
                </li>
                {{/each}}
              <ul>
            </div>
          </section>
        </div>
      </aside>
    {% endverbatim %}
  </script>

  <script id="conclusion-content" type="text/x-handlebars-template">
    {% verbatim %}
      <div class="page-content ma__decision-tree-node ma__decision-tree-node--answer">
        <h2 class="ma__colored-heading ma__colored-heading--green">
          {{#if step.editLink }}<a href="{{step.editLink}}" class="edit-link">[edit]</a>{{/if}}
          Answer
        </h2>
        <h3 class="ma__decision-tree__qa">{{step.text}}</h3>
        {{#if step.details}}
        <p>{{{step.details}}}</p>
        {{/if}}

        {{#if step.actions }}
        <section class="ma__key-actions">
          <div class="ma__key-actions__container">
            <div class="ma__key-actions__items">
            {{#each step.actions}}
              <div class="ma__callout-link">
                <a href="{{url}}"><span class="ma__callout-link__container"><span class="ma__callout-link__text" >{{text}}&nbsp;
                {{ icon('arrow', '20px', '20px')}}
                </span></span></a>
              </div>
            {{/each}}
            </div>
          </div>
        </section>
        {{/if}}

        {{#if step.video }}
        <div class="ma__video ma__video--new">
          <div class="ma__video__container js-ma-responsive-video">
            <iframe width="{{ step.video.width }}" height="{{ step.video.height }}" src="{{ step.video.src }}" frameborder="0" allowfullscreen aria-label="{{ video.label }}"></iframe>
          </div>
        </div>
        {{/if}}

        <div class="back">
          <a href="#">
            {{ icon('caret-left', '36px', '36px') }}
            Go Back
          </a>
        </div>
        <div class="restart">
          <a href="#">Start Over</a>
        </div>
      </div>
      <aside class="sidebar">
        <div class="ma__decision-tree-responses">
          <h2 class="ma__colored-heading ">Your Responses</h2>
          <section class="ma__link-list">
            <div class="ma__link-list__container">
              <ul class="ma__link-list__items ">
                {{#each responses}}
                <li class="ma__link-list__item">
                  <span class="ma__input-checkbox">
                    <input type="checkbox" value="checkbox" id="checkbox-test" checked disabled>
                    <label for="checkbox-test"><span>{{explainer}}</span></label>
                  </span>
                </li>
                {{/each}}
              <ul>
            </div>
          </section>
        </div>
      </aside>
    {% endverbatim %}
  </script>
{% endblock %}

{% block postContent %}
  <div class="ma__stacked-row">
    <section class="ma__stacked-row__section">
      <div class="ma__stacked-row__container">
        <div class="ma__decision-tree-post">
          {% if disclaimer %}
            <section class="ma__callout-alert">
              <div class="ma__callout-alert__content">
                <div class="ma__callout-alert__icon">
                  {{ icon('chat', '36px', '36px', null, false) }}
                </div>
                <div class="ma__callout-alert__link">
                  {{ disclaimer }}
                </div>
              </div>
            </section>
          {% endif %}
        </div>
      </div>
      {{ content.extra_org_feedback_form }}
    </section>
  </div>
  <span id="decision-tree-current-node" value=""></span>
{% endblock %}
