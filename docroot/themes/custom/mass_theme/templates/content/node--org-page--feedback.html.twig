{#
/**
 * @file
 * Theme override to display the feedback view mode.
 */
 #}
{{ attach_library('mass_feedback_form/feedback-form-behaviors') }}
{% set org_name = node.field_org_sentence_phrasing is empty ? node.title.value : content.field_org_sentence_phrasing|render|trim %}
{% set response = false %}
{% set responseRequired = false %}
{% set noResponseDescription = false %}
{% set contactInputs = [] %}
{% if node.field_constituent_communication.value == 'contact' %}
  {% set response = "Would you like a response from" %}
  {% set responseRequired = {
    "responseDescription": content.field_response_expectations,
    "inputGroup": {
      "required": true,
      "inline": true,
      "title": "",
      "type": "radio",
      "items": [
        {
          "name": "field70611737",
          "value": "Yes",
          "id": "field70611737_1",
          "label": "Yes",
          "required": true,
          "checked": false
        },
        {
          "name": "field70611737",
          "value": "No",
          "id": "field70611737_2",
          "label": "No",
          "required": true,
          "checked": false
        }
      ]
    }
  } %}
  {% set contactInputs = [
    {
      "hiddenLabel": false,
      "labelText": "First Name",
      "required": false,
      "id": "field70611807",
      "name": "field70611807",
      "type": "text",
      "noOptionalLabel": true
    },
    {
      "hiddenLabel": false,
      "labelText": "Last Name",
      "required": false,
      "id": "field70611815",
      "name": "field70611815",
      "type": "text",
      "noOptionalLabel": true
    },
    {
      "hiddenLabel": false,
      "labelText": "Phone",
      "required": false,
      "id": "field70611804",
      "name": "field70611804",
      "type": "tel",
      "noOptionalLabel": true
    },
    {
      "hiddenLabel": false,
      "labelText": "Email",
      "required": false,
      "id": "field70611812",
      "name": "field70611812",
      "type": "email",
      "noOptionalLabel": true
    }
  ] %}
{% else %}
  {% set response = "Your feedback will not receive a response." %}
  {% set noResponseDescription = "This form only gathers feedback about the website." %}
{% endif %}

{% if node.field_urgent_warning is empty or node.field_urgent_warning.value == 0 %}
  {% set reportMessage = false %}
{% else %}
  {% set reportMessage = {
    "id": "",
    "text": "If you need to report child abuse, any other kind of abuse, or need urgent assistance, please click here.",
    "href": "https://www.mass.gov/info-details/report-abuse-or-request-urgent-assistance",
    "info": ""
  } %}
{% endif %}

<div class="feedback-steps">
  <span id="feedback"></span>
  <div id="feedback-step-1" class="feedback-step" data-feedback-next="feedback-step-2">


{# MF TEMPALTE BEGINS #}
{% set requiredIndicator %}
 <span aria-hidden="true"> * </span><span class="visually-hidden">required</span>
{% endset %}

  {# =========== #}

<div class="ma__mass-feedback-form">
  <h2 class="visually-hidden">Feedback</h2>
  <form class="ma__mass-feedback-form__form" method="post" novalidate action="https://www.formstack.com/forms/index.php" id="2521317">

    <fieldset class="ma_feedback-fieldset feedback-load" role="radiogroup">
      <legend>Did you find what you were looking for on this webpage?
      {{ requiredIndicator }}</legend>

{# Q1: radio buttons #}
      <div class="ma__input-group__items ma__input-group__items--inline">
        <div class="ma__input-group__item">
          <span class="ma__input-radio">
            <input
              class="fsField required js-q1"
              id="field47054416_1"
              name="field47054416"
              type="radio"
              value="Yes"
              required
              aria-required="true"
              aria-invalid="false"
              />
            <label
            class="fsOptionLabel ma__input-radio__label"
            for="field47054416_1">Yes</label>
          </span>
        </div>

        <div class="ma__input-group__item">
          <span class="ma__input-radio">
            <input
              class="fsField required js-q1" id="field47054416_2" name="field47054416"
              type="radio"
              value="No"
              required
              aria-required="true"
              aria-invalid="false"
              />

            <label class="fsOptionLabel ma__input-radio__label"
            for="field47054416_2">No</label>
          </span>
        </div>
      </div>
{# END Q1 #}
    </fieldset>

    <div class="ma__mass-feedback-form__fields">
      <fieldset class="ma_feedback-fieldset">

{# Q2: response textarea #}

  {# label-YES #}
        <label class="feedback-response feedback-positive" for="field52940022">
          Do you have anything else to tell us?
        </label>
  {# label-NO #}
        <label class="feedback-response feedback-negative">
          Please tell us what you were looking for.{{ requiredIndicator }}
        </label>

        <div id="note1" class="ma__disclaimer">
          <p>We will use this information to improve the site.</p>
        </div>

{# textarea-YES #}
        <div class="feedback-response feedback-positive">
          <textarea id="field52940022"
                class="fsField"
                name="field52940022"
                maxlength="5000"
                disabled="disabled"
                aria-describedby="feedback-note"></textarea>
        </div>
{# textarea-NO #}
        <div class="feedback-response feedback-negative">
          <textarea id="field47054414"
                class="fsField required"
                name="field47054414"
                required
                aria-required="true"
                aria-invalid="false"
                maxlength="5000"
                disabled="disabled"
                aria-describedby="note1 note2"></textarea>
        </div>

        <div id="note2" class="ma__helper-text">
          <p>Do not include sensitive information, such as Social Security or bank account numbers.</p>
        </div>

      {% if response %}
        <div class="ma__mass-feedback-form__form--user-response feedback-response feedback-negative">
        {% if responseRequired %}
          {% if responseRequired.inputGroup %}
          <fieldset class="ma_feedback-fieldset user-response__contact" role="radiogroup">
            <legend>{{ response }} {{ org }}? {{ requiredIndicator }}{# * #}</legend>

            {# {% set inputGroup = responseRequired.inputGroup %} #}
            <div class="ma__input-group">
              <div class="ma__input-group__items ma__input-group__items--inline">
                <div class="ma__input-group__item">
                  <span class="ma__input-radio">
                    <input
                      class="fsField required"
                      id="field70611737_1"
                      name="field70611737"
                      type="radio"
                      value="Yes"
                      required
                      aria-required="true"
                      aria-invalid="false"
                      />
                    <label
                    class="fsOptionLabel ma__input-radio__label"
                    for="field70611737_1">Yes</label>
                  </span>
                </div>

                <div class="ma__input-group__item">
                  <span class="ma__input-radio">
                    <input
                      class="fsField required"
                      id="field70611737_2"
                      name="field70611737"
                      type="radio"
                      value="No"
                      required
                      aria-required="true"
                      aria-invalid="false"
                      />
                    <label
                    class="fsOptionLabel ma__input-radio__label"
                    for="field70611737_2">No</label>
                  </span>
                </div>
              </div>{# .ma__input-group__items  #}
            </div>{# .ma__input-group #}

            <div class="ma__mass-feedback-form__contact-form">
              {% if responseRequired.responseDescription %}
                <p class="response-info">{{ responseRequired.responseDescription }}</p>
              {% endif %}

              <div class="ma__mass-feedback-form__contact-form--items">
              {% for input in contactInputs %}
                <div class="contact-form--item">
                  <label
                    for="{{ input.id }}"
                    class="ma__label">{{input.labelText}}</label>
                  <input
                    class="ma__input"
                    name="{{ input.name }}"
                    id="{{ input.id }}"
                    type="{{ input.type }}"
                    data-type="{{ input.type }}" />
                </div>{# .contact-form--item #}
              {% endfor %}
              </div>{# .ma__mass-feedback-form__contact-form--items #}

            </div>{# .ma__mass-feedback-form__contact-form #}
          </fieldset>
          {% endif %}
        {% else %}
          {% if noResponseDescription %}
          <div>
            {{ response }}
            <button type="button" class="ma__content-link--chevron form--no-response" id="info-1" aria-expanded="false">Why? </button>
          </div>
          <p class="no-response-info" aria-labelledby="info-1">{{ noResponseDescription }}</p>
          {% endif %}
        {% endif %}
        </div>
      {% endif %}

      </fieldset>
    </div>{# .ma__mass-feedback-form__form--user-response feedback-response #}

    <div class="ma_feedback-fieldset ma__mass-feedback-form__form--submit-wrapper">
      <input class="submitButton ma__button ma__button--small" type="submit" value="Send Feedback" />
    </div>

    {% set hiddenElements = [
      {
        "id": "field47056299",
        "name": "field47056299",
        "value": url('<current>'),
        "class": "fsField"
      },
      {
        "id": "field58154059",
        "name": "field58154059",
        "value": "entityId",
        "class": "fsField data-layer-substitute"
      },
      {
        "id": "field57432673",
        "name": "field57432673",
        "value": "entityId",
        "class": "fsField data-layer-substitute"
      },
      {
        "id": "field68798989",
        "name": "field68798989",
        "value": "uniqueId",
        "class": "fsField unique-id-substitute"
      },
      {
        "id": "form2521317",
        "name": "form",
        "value": "2521317"
      },
      {
        "id": "viewkeyvx39GBYJhi",
        "name": "viewkey",
        "value": "vx39GBYJhi"
      },
      {
        "id": "hidden_fields2521317",
        "name": "hidden_fields",
        "value": ""
      },
      {
        "id": "submit2521317",
        "name": "_submit",
        "value": "1"
      },
      {
        "id": "style_version2521317",
        "name": "style_version",
        "value": "3"
      },
      {
        "id": "viewparam",
        "name": "viewparam",
        "value": "524744"
      }
    ] %}
    {% for element in hiddenElements %}
      <input type="hidden" id="{{ element.id }}" name="{{ element.name }}" value="{{ element.value }}" class="{{ element.class }}" />
    {% endfor %}
  </form>
</div>

{# TODO: MOVE TO OVERRIDE CSS #}
<style>
  div.ma_feedback-fieldset {
    margin-top: 45px;
  }
  #note2 {
    margin-bottom: .25em;
    padding: 0;
  }
  #note2 p {
    margin: 0;
    padding: 0;
  }
  .ma__mass-feedback-form__form--user-response div {
    margin-bottom: .25em;
    padding: 0;
    font-weight: 500;
  }
  button.ma__content-link--chevron {
    -webkit-transition: all 0.4s ease;
    -o-transition: all 0.4s ease;
    transition: all 0.4s ease;
    text-decoration: none;
    font-weight: 700;
    color: #14558f;
    border: 0;
    background: transparent;
  }
  .ma__mass-feedback-form__form--user-response.feedback-response
  button.ma__content-link--chevron::after {
    top: 0;
  }
  .ma__mass-feedback-form__form--user-response.is-open button.ma__content-link--chevron::after {
    top: -4px;
  }

</style>

{# END OF CURRENT EDIT #}
{# <h2 style="color: purple;">END OF CURRENT EDIT</h2> #}
{# END OF CURRENT EDIT #}


{# MF TEMPLATE ENDS #}

{# STEP 2 #}
  <div id="feedback-step-2" class="feedback-step hidden" data-feedback-next="feedback-step-3">
    {% set contact = false %}
    {% if node.field_constituent_communication.value == 'link' and node.field_feedback_com_link is not empty %}
      {% set contact = content.field_feedback_com_link[0]['#url'] %}
    {% endif %}
    {# {% include "@organisms/feedback/mass-feedback-success.twig" with {
      "title": "Thanks, your message has been sent to",
      "action": "#",
      "org": org_name,
      "description": "Would you like to provide additional feedback to help improve Mass.gov?",
      "contactLink": contact
    } %} #}
    <div class="ma__mass-feedback-form ma__mass-feedback-form--success" id="feedback-success" data-mass-feedback-form>
      <h3>Thanks, your message has been sent to {{ org_name }}!</h3>
{# TODO: ADD VALID ACTION VALUE. OR REMOVE THE FORM, WHICH DOESN'T SEEM TO BE NECESSARY IN THIS CASE. #}
      <form class="ma__mass-feedback-form__form" method="post" novalidate="" action="#" class="" id="">

      {% if contact %}
        <span class="ma__decorative-link">
{# TODO: CHANGE THE 'CICK HERE' TEXT. #}
          <a href="{{ contact }}">If you need to contact {{ org_name }}, please click here&nbsp;{{ icon('arrow') }}</a>
        </span>
      {% endif %}
        <p>Would you like to provide additional feedback to help improve Mass.gov?</p>

        <div class="ma__mass-feedback-form__form--submit-wrapper">
{# CONFIRM: THIS SEEMS TO BE A SIMPLE LINK TO THE SURVEY PAGE.  #}
          <input class="submitButton ma__button ma__button--small" type="submit" value="Start Survey" />
        </div>
      </form>
    </div>
  </div>

{# STEP 3 #}
  <div id="feedback-step-3" class="feedback-step hidden" data-feedback-next="feedback-step-4">
    {% include "@organisms/feedback/secondary-survey.twig" with {
      "formId": "3184363",
      "formAction": "https://massgov.formstack.com/forms/index.php",
      "radioScalesGroups": {
        "title": "",
        "startScaleLabel": "Strongly Disagree",
        "endScaleLabel": "Strongly Agree",
        "groups": [
          {
            "path": "@atoms/03-forms/radio-scale.twig",
            "data": {
            "radioScale": {
              "legend": "This page is helpful.",
              "required": true,
              "groupID": "field68557157",
              "name": "field68557157",
              "items": [
                {
                  "value": "1",
                  "id": "field68557157_1",
                  "label": "1",
                  "text": "",
                  "checked": false
                },
                {
                  "value": "2",
                  "id": "field68557157_2",
                  "label": "2",
                  "text": "",
                  "checked": false
                },
                {
                  "value": "3",
                  "id": "field68557157_3",
                  "label": "3",
                  "text": "",
                  "checked": false
                },
                {
                  "value": "4",
                  "id": "field68557157_4",
                  "label": "4",
                  "text": "",
                  "checked": false
                },
                {
                  "value": "5",
                  "id": "field68557157_5",
                  "label": "4",
                  "text": "",
                  "checked": false
                }
              ]
            }
          }
          },
          {
            "path": "@atoms/03-forms/radio-scale.twig",
            "data": {
            "radioScale": {
              "legend": "This page is easy to use.",
              "required": true,
              "groupID": "field68557204",
              "name": "field68557204",
              "items": [
                {
                  "value": "1",
                  "id": "field68557204_1",
                  "label": "1",
                  "text": "",
                  "checked": false
                },
                {
                  "value": "2",
                  "id": "field68557204_2",
                  "label": "2",
                  "text": "",
                  "checked": false
                },
                {
                  "value": "3",
                  "id": "field68557204_3",
                  "label": "3",
                  "text": "",
                  "checked": false
                },
                {
                  "value": "4",
                  "id": "field68557204_4",
                  "label": "4",
                  "text": "",
                  "checked": false
                },
                {
                  "value": "5",
                  "id": "field68557204_5",
                  "label": "4",
                  "text": "",
                  "checked": false
                }
              ]
            }
          }
          },
          {
            "path": "@atoms/03-forms/radio-scale.twig",
            "data": {
            "radioScale": {
              "legend": "I am confident that I will find the information that I need.",
              "required": true,
              "groupID": "field68557235",
              "name": "field68557235",
              "items": [
                {
                  "value": "1",
                  "id": "field68557235_1",
                  "label": "1",
                  "text": "text",
                  "checked": false
                },
                {
                  "value": "2",
                  "id": "field68557235_2",
                  "label": "2",
                  "text": "",
                  "checked": false
                },
                {
                  "value": "3",
                  "id": "field68557235_3",
                  "label": "3",
                  "text": "",
                  "checked": false
                },
                {
                  "value": "4",
                  "id": "field68557235_4",
                  "label": "4",
                  "text": "",
                  "checked": false
                },
                {
                  "value": "5",
                  "id": "field68557235_5",
                  "label": "4",
                  "text": "",
                  "checked": false
                }
              ]
            }
          }
          }
        ]
      },
      "doToday": {
        "labelText": "Text Area",
        "hiddenLabel": true,
        "required": false,
        "id": "field68557240",
        "maxlength": 500,
        "name": "field68557240"
      },
      "inputGroup": {
        "required": true,
        "inline": false,
        "title": "",
        "type": "radio",
        "items": [
          {
            "name": "field68557373",
            "value": "Personal",
            "id": "field68557373_1",
            "label": "Personal",
            "checked": false
          },
          {
            "name": "field68557373",
            "value": "Professional",
            "id": "field68557373_2",
            "label": "Professional",
            "checked": false
          }
        ]
      },
      "otherFeedback": {
        "labelText": "Text Area",
        "hiddenLabel": true,
        "required": false,
        "id": "field68557414",
        "maxlength": 1000,
        "name": "field68557414"
      },
      "emailContact": {
        "labelText": "Email",
        "hiddenLabel": true,
        "required": false,
        "id": "field68557501",
        "name": "field68557501",
        "type": "email",
        "width": "375"
      },
      "hiddenElements": [
        {
          "id": "field68557708",
          "name": "field68557708",
          "value": "uniqueId",
          "class": "fsField unique-id-substitute"
        },
        {
          "id": "form3184363",
          "name": "form",
          "value": "3184363"
        },
        {
          "id": "viewkeymLaeYhDMyl",
          "name": "viewkey",
          "value": "mLaeYhDMyl"
        },
        {
          "id": "hidden_fields3184363",
          "name": "hidden_fields",
          "value": ""
        },
        {
          "id": "submit3184363",
          "name": "_submit",
          "value": "1"
        },
        {
          "id": "style_version3184363",
          "name": "style_version",
          "value": "3"
        },
        {
          "id": "viewparam524744",
          "name": "viewparam",
          "value": "524744"
        }
      ]
    } %}
  </div>
  <div id="feedback-step-4" class="feedback-step hidden">
    {# {% include "@organisms/feedback/mass-feedback-thank-you.twig" with {
      "title": "Thanks, your survey has been submitted to the Mass.gov team!",
      "description": "If you would like to continue helping us improve Mass.gov, join our user panel to test new features for the site.",
      "link": {
        "text": "Join user panel",
        "href": "https://www.mass.gov/user-panel?utm_source=survey"
      }
    } %} #}
    <div class="ma__mass-feedback-form thank-you-panel">
      <h3>Thanks, your survey has been submitted to the Mass.gov team!</h3>
      <p>If you would like to continue helping us improve Mass.gov, join our user panel to test new features for the site.</p>
      <span class="ma__decorative-link">
        <a href="https://www.mass.gov/user-panel?utm_source=survey">Join user panel&nbsp;{{ icon('arrow') }}</a>
      </span>
    </div>
  </div>
</div>

{# <script>
const radioSelected = document.querySelector('.js-q1');
const textareaElementsPositive = document.querySelectorAll('feedback-positive');
const textareaElementsNegative = document.querySelectorAll('feedback-negative');
// Show YES text area, hide NO text area.
radioSelected.addEventListener('click', function(event){
  // First click.
  if (this.getAttribute('value') === 'yes') {
    textareaElementsPositive.classList.add('is-open');
    textareaElementsPositive.querySelector('.feedback-positive textarea').removeAttribute('disabled');
  }
  if (this.getAttribute('value') === 'no')
  {
    textareaElementsPositive.classList.add('is-open');
  }
  // Toggle
    textareaElementsPositive.classList.toggle('is-open');
});

// Select all required fields.
const requiredFields = document.querySelectorAll('fsField');
// Submit button.
const submitButton = document.querySelector('submitButton');
// Validate required fields.
submitButton.addEventListener('click', function(event){
  for (const field of requiredFields) {
    if (this.hasAttribute('checked')) {
      console.log('We have a winner!');
      break;
    }
    console.log('nothing checked');
  }
});
// Mark invalid field.

</script> #}